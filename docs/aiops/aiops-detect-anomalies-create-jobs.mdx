---
id: serverlessObservabilityAiopsDetectAnomaliesCreateJobs
slug: /serverless/observability/aiops-detect-anomalies-create-jobs
title: Create and run anomaly detection jobs
# description: Description to be written
tags: [ 'serverless', 'observability', 'how-to' ]
status: rough content
---

import RoughContent from '../partials/rough-content-notice.mdx'

<RoughContent />

import AnomalyDetectionJobTips from '../transclusion/machine-learning/anomaly-detection/job-tips.mdx'
import AnomalyDetectionMlDatafeeds from '../transclusion/machine-learning/anomaly-detection/ml-datafeeds.mdx'
import AnomalyDetectionMlCalendars from '../transclusion/machine-learning/anomaly-detection/ml-calendars.mdx'
import AnomalyDetectionMlRules from '../transclusion/machine-learning/anomaly-detection/ml-rules.mdx'
import AnomalyDetectionMlModelSnapshots from '../transclusion/machine-learning/anomaly-detection/ml-model-snapshots.mdx'
import AnomalyDetectionStoppingMl from '../transclusion/machine-learning/anomaly-detection/stopping-ml.mdx'

<div id="ml-ad-run-jobs"></div>

((anomaly-jobs-cap)) contain the configuration information and metadata
necessary to perform the ((ml)) analysis. They can run for a specific time period
or continuously against incoming data.

<div id="ml-ad-setup"></div>

## Set up the environment

Before you can use the ((stack-ml-features)), there are some configuration
requirements (such as security privileges) that must be addressed. Refer to
 <DocBadge><DocIcon size="s" type="unlink" title="missing link"/> missing link</DocBadge>{/* <DocLink id="enMachineLearningSetup">Set up ((ml-features))</DocLink> */}.

<DocCallOut title="Note">

If your data is located outside of ((es)), you cannot use ((kib)) to create
your jobs and you cannot use ((dfeeds)) to retrieve your data in real time.
Posting data directly to ((anomaly-jobs)) is deprecated, in a future major version
a ((dfeed)) will be required.

</DocCallOut>

<div id="ml-ad-create-job"></div>

## Create an ((anomaly-job))

You can create ((anomaly-jobs)) by using the
[create ((anomaly-jobs)) API](((ref))/ml-put-job.html). ((kib)) also provides
wizards to simplify the process, which vary depending on whether you are using
the ((ml-app)) app, ((security-app)) or ((observability)) apps. In **((ml-app))** >
**Anomaly Detection**:

<div style={{ backgroundColor: "#F1F4FA", width: "100%", height: "250px", textAlign: "center", paddingTop: "110px", marginBottom: "20px" }}><DocIcon type="image" title="missing image"/> missing image</div>
{/* ![Create New Job](images/ml-ad-run-jobs/-ml-anomaly-detection-ml-create-job.png) */}
{/* NOTE: This is an autogenerated screenshot. Do not edit it directly. */}

* The single metric wizard creates simple jobs that have a single detector. A
    _detector_ applies an analytical function to specific fields in your data. In
    addition to limiting the number of detectors, the single metric wizard omits
    many of the more advanced configuration options.

* The multi-metric wizard creates jobs that can have more than one detector,
    which is more efficient than running multiple jobs against the same data.

* The population wizard creates jobs that detect activity that is unusual compared
    to the behavior of the population.

* The categorization wizard creates jobs that group log messages into categories
    and use `count` or `rare` functions to detect anomalies within them.

* The advanced wizard creates jobs that can have multiple detectors and enables
    you to configure all job settings.

{/* TBD The rare wizard creates jobs that use `rare` or `freq_rare` functions to detect */}

((kib)) can also recognize certain types of data and provide specialized wizards
for that context. For example, there are ((anomaly-jobs)) for the sample
eCommerce orders and sample web logs data sets, as well as for data generated by
the ((elastic-sec)) and ((observability)) solutions, ((beats)), and ((agent))
((integrations)). For a list of all the preconfigured jobs, see <DocBadge><DocIcon size="s" type="unlink" title="missing link"/> missing link</DocBadge>{/*  <DocLink id="enMachineLearningOotbMlJobs">Supplied ((anomaly-detect)) configurations</DocLink> */}.

<div id="ml-ad-job-tips"></div>

<AnomalyDetectionJobTips />

{/*
You can optionally assign jobs to one or more _job groups_. You can use
job groups to view the results from multiple jobs more easily and to expedite
administrative tasks by opening or closing multiple jobs at once. 

*/}

{/* TBD Mention impact of model plot config? */}

<div id="ml-ad-datafeeds"></div>

### ((dfeeds-cap))

<AnomalyDetectionMlDatafeeds />

<div id="ml-ad-open-job"></div>

## Open the job

An ((anomaly-job)) must be opened in order for it to be ready to receive and
analyze data. It can be opened and closed multiple times throughout its
lifecycle.

After you start the job, you can start the ((dfeed)), which retrieves data from
your cluster. A ((dfeed)) can be started and stopped multiple times throughout its
lifecycle. When you start it, you can optionally specify start and end times. If
you do not specify an end time, the ((dfeed)) runs continuously.

You can perform both these tasks in ((kib)) or use the
[open ((anomaly-jobs))](((ref))/ml-open-job.html) and
[start ((dfeeds))](((ref))/ml-start-datafeed.html) APIs.

<div id="ml-ad-tune"></div>

## Tune the job

Typically after you open a job, the next step is to
<DocLink id="serverlessObservabilityAiopsDetectAnomaliesViewResults">view the results</DocLink>. You might find that you need to alter
the job configuration or settings.

<div id="ml-ad-calendars"></div>

### Calendars and scheduled events

<AnomalyDetectionMlCalendars />

<div id="ml-ad-rules"></div>

### Custom rules

<AnomalyDetectionMlRules />

<div id="ml-ad-model-snapshots"></div>

### Model snapshots

<AnomalyDetectionMlModelSnapshots />

<div id="ml-ad-close-job"></div>

## Close the job

When historical data is analyzed, there is no need to stop the ((dfeed)) and/or
close the job as they are stopped and closed automatically when the end time is
reached.

<AnomalyDetectionStoppingMl />
