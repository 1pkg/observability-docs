

import NoDataIndexed from '../../transclusion/apm/guide/tab-widgets/no-data-indexed/fleet-managed.mdx'
import GettingStartedApmServerInstallApmIntegration from '../../transclusion/apm/guide/getting-started-apm-server/install-apm-integration.mdx'

This section describes common problems you might encounter.

{/* * <DocLink id="serverlessObservabilityApmTroubleshooting" section="no-data-is-indexed">No data is indexed</DocLink>
* <DocLink id="serverlessObservabilityApmTroubleshooting">APM Server response codes</DocLink>
* <DocLink id="serverlessObservabilityApmTroubleshooting" section="common-ssl-related-problems">Common SSL-related problems</DocLink>
* <DocLink id="serverlessObservabilityApmTroubleshooting" section="io-timeout">I/O Timeout</DocLink>
* <DocLink id="serverlessObservabilityApmTroubleshooting" section="field-limit-exceeded">Field limit exceeded</DocLink> */}

### No data is indexed

If no data shows up, first make sure that your APM components are properly connected.

<NoDataIndexed />

{/* <div id="data-indexed-no-apm-legacy"></div> */}

{/* ### Data is indexed but doesn't appear in the APM UI */}

{/* Elastic APM relies on index mappings to query and display data.
If your APM data isn't showing up in the APM UI, but is elsewhere in ((kib)), like the Discover app,
you may have a missing index mapping. */}

{/*
I tried running this and got an error:
"uri with method [GET] exists but is not available when running in serverless mode""
*/}

{/* You can determine if a field was mapped correctly with the `_mapping` API.
For example, run the following command in the <DocLink id="serverlessDevtoolsRunApiRequestsInTheConsole">Developer Tools console</DocLink>.
This will display the field data type of the `service.name` field. */}

{/* ```shell */}
{/* GET *apm*/_mapping/field/service.name */}
{/* ``` */}


{/* If the `mapping.name.type` is `"text"`, your APM indices were not set up correctly. */}

{/* ```yml
".ds-metrics-apm.transaction.1m-default-2023.04.12-000038": {
   "mappings": {
      "service.name": {
         "full_name": "service.name",
         "mapping": {
            "name": {
               "type": "text"  [^1]
            }
         }
      }
   }
}
```
[^1]: The `service.name` `mapping.name.type` would be `"keyword"` if this field had been set up correctly. */}

{/* To fix this problem, install the APM integration by following these steps: */}

{/* <GettingStartedApmServerInstallApmIntegration /> */}

{/* This will reinstall the APM index templates and trigger a data stream index rollover. */}

{/* You can verify the correct index templates were installed by running the following command in the ((kib)) console: */}

{/* ```shell
GET /_index_template/traces-apm
``` */}

{/* ### I/O Timeout

I/O Timeouts can occur when your timeout settings across the stack are not configured correctly,
especially when using a load balancer.

You may see an error like the one below in the ((apm-agent)) logs, and/or a similar error on the APM Server side:

```logs
[ElasticAPM] APM Server responded with an error:
"read tcp 123.34.22.313:8200->123.34.22.40:41602: i/o timeout"
```

To fix this, ensure timeouts are incrementing from the ((apm-agent)),
through your load balancer, to the APM Server.

By default, the agent timeouts are set at 10 seconds, and the server timeout is set at 3600 seconds.
Your load balancer should be set somewhere between these numbers.

For example:

```txt
APM agent --> Load Balancer  --> APM Server
   10s            15s               3600s
``` */}

{/* I couldn't find a way to configure this */}

{/* The APM Server timeout can be configured by updating the maximum duration for reading an entire request</DocLink>. */}

<div id="field-limit-exceeded-legacy"></div>

### Field limit exceeded

When adding too many distinct tag keys on a transaction or span,
you risk creating a [mapping explosion](((ref))/mapping.html#mapping-limit-settings).

For example, you should avoid that user-specified data,
like URL parameters, is used as a tag key.
Likewise, using the current timestamp or a user ID as a tag key is not a good idea.
However, tag **values** with a high cardinality are not a problem.
Just try to keep the number of distinct tag keys at a minimum.

The symptom of a mapping explosion is that transactions and spans are not indexed anymore after a certain time. Usually, on the next day,
the spans and transactions will be indexed again because a new index is created each day.
But as soon as the field limit is reached, indexing stops again.

In the agent logs, you won't see a sign of failures as the APM server asynchronously sends the data it received from the agents to ((es)). However, the APM server and ((es)) log a warning like this:

```logs
{\"type\":\"illegal_argument_exception\",\"reason\":\"Limit of total fields [1000] in [INDEX_NAME] has been exceeded\"}
```
