---
id: serverlessObservabilityApmAgentsNodejsSupportedTechnologies
slug: /serverless/observability/apm-agents-nodejs-supported-technologies
title: Supported technologies
# description: Description to be written
tags: [ 'serverless', 'observability', '' ]
status: rough content
---

import RoughContent from '../partials/rough-content-notice.mdx'

<RoughContent />

<div id="supported-technologies"></div>

export let env_github = false

<DocIf condition={ env_github === true }>

<DocCallOut title="Note">
For the best reading experience,
please view this documentation at [elastic.co](https://www.elastic.co/guide/en/apm/agent/nodejs/current/supported-technologies.html)
</DocCallOut>

</DocIf>

The Elastic APM Node.js Agent automatically instruments various APIs in Node.js core and third-party frameworks and packages. This page lists all supported technologies and version ranges.

<div id="compatibility-node"></div>

## Node.js versions

Support for the Elastic APM Node.js agent follows the [support schedule of Node.js itself](https://nodejs.org/en/about/releases/)
to the end-of-life period of each version after its maintenance term.
Versions of Node.js past their end-of-life date are not supported.

image::./images/node_release_schedule.svg[Node.js release schedule]

The current APM agent version (3.x) works with Node.js versions back to v8.6. We will only break support for older Node.js versions with a major version release of the APM agent.

<div id="compatibility-esm"></div>

## ECMAScript Modules (ESM)

Beginning with version v3.48.0, the Elastic APM Node.js agent includes
_limited and experimental_ support for instrumenting
[ECMAScript module imports](https://nodejs.org/api/esm.html#modules-ecmascript-modules),
i.e. modules that are loaded via `import ...` statements and `import('...')` (dynamic import).
See the <DocBadge><DocIcon size="s" type="unlink" title="missing link"/> missing link</DocBadge>{/*  <DocLink id="enApmAgentNodejsEsm">ECMAScript module support</DocLink> */} document for details.

Note: If you are using TypeScript or JavaScript that is _compiled/translated/transpiled to CommonJS-using JavaScript_ via tools like Babel, Webpack, esbuild, etc., then using `import ...` in your source code is fine. To ensure your compiler is generating JS that uses CommonJS imports, use the following settings:

- For TypeScript, use [`"module": "commonjs"` in your "tsconfig.json"](https://www.typescriptlang.org/tsconfig#module) (a [complete tsconfig.json example](https://github.com/tsconfig/bases/blob/main/bases/node16.json)).
- For Babel, use [`"modules": "commonjs"` in your Babel config](https://babeljs.io/docs/en/babel-preset-env#modules) ([for example](https://github.com/elastic/apm-agent-nodejs/blob/main/test/babel/.babelrc)).
- For Webpack, use `target: 'node', externalsPresets: { node: true }` in your "webpack.config.js".
- For esbuild, use `--platform=node --target=node...` options to `esbuild` ([for example](https://github.com/elastic/apm-agent-nodejs/blob/main/examples/esbuild/package.json#L7)).

<div id="elastic-stack-compatibility"></div>

## Elastic Stack Compatibility

{/* See the APM agent compatibility table: https://www.elastic.co/guide/en/apm/guide/current/agent-server-compatibility.html */}

This agent is compatible with [APM Server](((apm-guide-ref))) v6.6 and above.

<div id="compatibility-frameworks"></div>

## Frameworks

Though you can use Elastic APM <DocLink id="serverlessObservabilityApmAgentsNodejsGetStarted">with any Node.js framework</DocLink>,
we automate a few things for the most popular Node.js modules.
These are the frameworks that we officially support:

| Framework | Version | Note |
|---|---|---|
| <DocLink id="serverlessObservabilityApmAgentsNodejsGetStarted">AWS Lambda</DocLink> | N/A |  |
| <DocLink id="serverlessObservabilityApmAgentsNodejsGetStarted">Azure Functions</DocLink> | ~4 | See [the guide on Azure Functions runtime versions](https://learn.microsoft.com/en-ca/azure/azure-functions/set-runtime-version). |
| <DocLink id="serverlessObservabilityApmAgentsNodejsGetStarted">Express</DocLink>   | ^4.0.0 |  |
| <DocLink id="serverlessObservabilityApmAgentsNodejsGetStarted">Fastify</DocLink>   | >=1.0.0 | See also [Fastify's own LTS documentation](https://www.fastify.io/docs/latest/Reference/LTS/) |
| <DocLink id="serverlessObservabilityApmAgentsNodejsGetStarted">@hapi/hapi</DocLink>   | >=17.9.0 \<22.0.0 |  |
| <DocLink id="serverlessObservabilityApmAgentsNodejsGetStarted">hapi</DocLink>         | >=9.0.0 \<19.0.0 | Deprecated. No longer tested. |
| <DocLink id="serverlessObservabilityApmAgentsNodejsGetStarted">Koa</DocLink> via koa-router or @koa/router | >=5.2.0 \<13.0.0 | Koa doesn't have a built in router, so we can't support Koa directly since we rely on router information for full support. We currently support the most popular Koa router called [koa-router](https://github.com/koajs/koa-router). |
| <DocLink id="serverlessObservabilityApmAgentsNodejsGetStarted">Next.js</DocLink>    | >=11.1.0 \<13.3.0 | (Technical Preview) This instruments Next.js routing to name transactions for incoming HTTP transactions; and reports errors in user pages. It supports the Next.js production server (`next start`) and development server (`next dev`). See the <DocLink id="serverlessObservabilityApmAgentsNodejsGetStarted">Getting Started document</DocLink>. |
| <DocLink id="serverlessObservabilityApmAgentsNodejsGetStarted">Restify</DocLink>   | >=5.2.0 \<12.0.0 |  |

<div id="compatibility-opentelemetry"></div>

## OpenTelemetry

The Node.js Elastic APM agent supports usage of the OpenTelemetry Tracing API
via its <DocBadge><DocIcon size="s" type="unlink" title="missing link"/> missing link</DocBadge>{/*  <DocLink id="enApmAgentNodejsOpentelemetryBridge">OpenTelemetry bridge</DocLink> */}. As well, it instruments the OpenTelemetry
Metrics API and Metrics SDK to allow
 <DocBadge><DocIcon size="s" type="unlink" title="missing link"/> missing link</DocBadge>{/* <DocLink id="enApmAgentNodejsOpentelemetryBridge" section="using-the-opentelemetry-metrics-api">usage of the OpenTelemetry Metrics API</DocLink> */}.

| Framework | Version |
|---|---|
| <DocBadge><DocIcon size="s" type="unlink" title="missing link"/> missing link</DocBadge>{/*  <DocLink id="enApmAgentNodejsOpentelemetryBridge">@opentelemetry/api</DocLink> */} | >=1.0.0 \<1.5.0 |
| [@opentelemetry/sdk-metrics](https://www.npmjs.com/package/@opentelemetry/sdk-metrics) | >=1.11.0 \<2 |

<div id="compatibility-custom-transactions"></div>

## Custom Transactions

By default transactions are named based on their matched HTTP route if the framework used is listed above.
These modules override that behavior to give better insights into specialized HTTP servers:

| Module | Version | Note |
|---|---|---|
| [express-graphql](https://www.npmjs.com/package/express-graphql) | >=0.6.1 \<0.13.0 | Will name all transactions by the GraphQL query name. There is a [known issue with node \<10.4](https://github.com/elastic/apm-agent-nodejs/issues/2516). This module is deprecated and is no longer tested. |
| [apollo-server-express](https://www.npmjs.com/package/apollo-server-express) | >=2.0.4 \< | Will name all transactions by the GraphQL query name. Versions before 2.9.6 are no longer tested. |
| [@apollo/server](https://www.npmjs.com/package/@apollo/server) | >=4.0. | Will name all transactions by the GraphQL query name |

<div id="compatibility-tracing-and-instrumentation"></div>

## Tracing and Instrumentation

The Node.js agent will automatically instrument the following modules to give you detailed performance metrics:

| Module | Version | Note |
|---|---|---|
| [aws-sdk](https://www.npmjs.com/package/aws-sdk) | >=2.858.0 \<3 | Will instrument SQS send/receive/delete messages, all S3 methods, all DynamoDB methods, and the SNS publish method |
| [@aws-sdk/client-s3](https://www.npmjs.com/package/@aws-sdk/client-s3) | >=3.15.0 \<4 | Will instrument all S3 methods |
| [cassandra-driver](https://www.npmjs.com/package/cassandra-driver) | >=3.0.0 \<5 | Will instrument all queries |
| [elasticsearch](https://www.npmjs.com/package/elasticsearch) | >=8.0.0 | Will instrument all queries |
| [@elastic/elasticsearch](https://www.npmjs.com/package/@elastic/elasticsearch) | >=7.0.0 \<9.0.0 | Will instrument all queries |
| [graphql](https://www.npmjs.com/package/graphql) | >=0.7.0 \<17 | Will instrument all queries |
| [handlebars](https://www.npmjs.com/package/handlebars) | * | Will instrument compile and render calls |
| [jade](https://www.npmjs.com/package/jade) | >=0.5.6 | Will instrument compile and render calls; Deprecated. No longer tested. Use pug. |
| [pug](https://www.npmjs.com/package/pug) | >=0.1.0 | Will instrument compile and render calls |
| [ioredis](https://www.npmjs.com/package/ioredis) | >=2.0.0 \<6.0.0 | Will instrument all queries |
| [memcached](https://www.npmjs.com/package/memcached) | >=2.2.0 | Will instrument all commands. |
| [mongodb-core](https://www.npmjs.com/package/mongodb-core) | >=1.2.19 \<4 | Will instrument all queries. A lot of higher level MongoDB modules use mongodb-core, so those should be supported as well. |
| [mongodb](https://www.npmjs.com/package/mongodb) | >=2.0.0 \<3.3.0 | Supported via mongodb-core |
| [mongodb](https://www.npmjs.com/package/mongodb) | >=3.3.0 \<6 | Will instrument all queries |
| [mongojs](https://www.npmjs.com/package/mongojs) | >=1.0.0 \<2.7.0 | Supported via mongodb-core |
| [mongoose](https://www.npmjs.com/package/mongoose) | >=4.0.0 \<5.7.0 | Supported via mongodb-core |
| [mysql](https://www.npmjs.com/package/mysql) | ^2.0.0 | Will instrument all queries |
| [mysql2](https://www.npmjs.com/package/mysql2) | >=1.0.0 \<4.0.0 | Will instrument all queries |
| [pg](https://www.npmjs.com/package/pg) | >=4.0.0 \<9.0.0 | Will instrument all queries |
| [redis](https://www.npmjs.com/package/redis) | >=2.0.0 \<5.0.0 | Will instrument all queries |
| [tedious](https://www.npmjs.com/package/tedious) | >=1.9 \<17.0.0 | (Excluding v4.0.0.) Will instrument all queries |
| [undici](https://www.npmjs.com/package/undici) | >=4.7.1 \<6 | Will instrument undici HTTP requests, except HTTP CONNECT. Requires node v14.17.0 or later, or the user to have installed the ['diagnostics_channel' polyfill](https://www.npmjs.com/package/diagnostics_channel). |
| [ws](https://www.npmjs.com/package/ws) | >=1.0.0 \<8.0.0 | Will instrument outgoing WebSocket messages |

<div id="compatibility-better-stack-traces"></div>

## Better Stack Traces

The APM agent <DocLink id="serverlessObservabilityApmAgentsNodejsConfigure" section="spanstacktraceminduration">can be configured</DocLink> to capture
span stack traces, to show where in your code a span (e.g. for a database query)
was initiated.

Given the async nature of Node.js, it's not possible for the APM agent to see
further back than the last async boundary. Modules that happen to have an async
boundary between a call from your application code and the action that leads
to an APM span will limit the utility of these span stack traces.

The modules listed below are those that the APM agent instruments to provide
more useful span stack traces -- ones that point to your application code --
when enabled.

If you don't see your own code in spans,
please create a new topic in the [Elastic APM discuss forum](https://discuss.elastic.co/c/apm) and include information about your dependencies.

| Module | Version | Note |
|---|---|---|
| [knex](https://www.npmjs.com/package/knex) | >=0.10.0 \<3.0.0 | Provides better span stack traces for 'pg' and 'mysql' spans. Instrumentation of Knex >=0.95.0 is not supported when using the deprecated <DocLink id="serverlessObservabilityApmAgentsNodejsConfigure" section="contextmanager">`contextManager=patch`</DocLink> configuration option. |

<div id="compatibility-continuity"></div>

## Continuity

The Elastic APM agent monitors async operations in your Node.js application to maintain awareness of which request is the active request at any given time.
Certain modules can interfere with this monitoring if not handled properly.

Below is a list of modules known to cause issues with this monitoring.
The versions listed are the versions we support.
If you use an unsupported version you might experience missing spans.
This does not impact the stability of your application in any way - only the collected metrics.

If you do experience missing spans in your performance metrics,
please create a new topic in the [Elastic APM discuss forum](https://discuss.elastic.co/c/apm) and include information about your dependencies and what data is missing.

| Module | Version | Note |
|---|---|---|
| [bluebird](https://www.npmjs.com/package/bluebird) | >=2.0.0 \<4.0.0 |  |
| [generic-pool](https://www.npmjs.com/package/generic-pool) | ^2.0.0 \|\| ^3.1.0  |
| Used by a lot of database modules like for instance "pg" | [express-queue](https://www.npmjs.com/package/express-queue) | >=0.0.11 \<1.0.0  |
