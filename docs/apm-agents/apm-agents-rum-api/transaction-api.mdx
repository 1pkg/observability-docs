

<div id="transaction-api"></div>

A transaction groups multiple spans in a logical group.

To start a transaction,
you need to call <DocLink id="serverlessObservabilityApmAgentsRumApi" section="apmstarttransaction">`apm.startTransaction()`</DocLink>.

To see an example of using custom transactions,
see the <DocBadge><DocIcon size="s" type="unlink" title="missing link"/> missing link</DocBadge>{/*  <DocLink id="enApmAgentRumJsCustomTransactions">Custom Transactions</DocLink> */} article.

<div id="transaction-name"></div>

### `transaction.name`

* **Type:** String
* **Default:** `Unknown`

The name of the transaction.

Can be used to set or overwrite the name of the transaction (visible in the performance monitoring breakdown).

<div id="transaction-type"></div>

### `transaction.type`

* **Type:** String
* **Default:** `custom`

The type of the transaction.

<div id="transaction-timestamp"></div>

### `transaction.timestamp`

* **Type:** String
* **Default:** `undefined`

The timestamp of the transaction.
If the transaction timestamp is not provided (the default behaviour), it will be set by the apm-server (v6.3+).
You can, however, set the timestamp on the client (using `new Date().toISOString()`), but you should be aware that the timestamp will reflect the client's local time
which might not always be accurate.

<div id="transaction-start-span"></div>

### `transaction.startSpan([name][, type][, options])`

```js
const span = transaction.startSpan('My custom span')
```

Start and return a new custom span associated with this transaction.

Arguments:

* `name` - The name of the span (string). Defaults to `unnamed`

* `type` - The type of span (string). Defaults to `custom`

* `options` - The following options are supported:

    * `blocking` - Blocks the associated transaction from ending until this span is ended. Blocked spans
        automatically create an internal task. Defaults to false.

    * `parentId` - Parent id associated with the new span. Defaults to current transaction id

    * `sync` - Denotes if the span is synchronous or asynchronous.

When a span is started it will measure the time until <DocLink id="serverlessObservabilityApmAgentsRumApi" section="spanend">`span.end()`</DocLink> is called. Blocked
spans allow users to control the early closing of <DocBadge><DocIcon size="s" type="unlink" title="missing link"/> missing link</DocBadge>{/*  <DocLink id="enApmAgentRumJsCustomTransactions" section="creating-a-managed-transaction">managed transactions</DocLink> */} in some cases.

See also the <DocLink id="serverlessObservabilityApmAgentsRumApi">Span API</DocLink> docs for details on how to use custom spans.

<div id="transaction-block"></div>

### `transaction.block(flag)`

```js
transaction.block(true)
```

Blocks the currently running auto-instrumented or custom transactions from getting automatically closed once the associated spans are ended.

Arguments:

* `flag` - Boolean. Defaults to false.

Most of the time, users shouldn't need to block the running transaction as the agent tries to account for all of the async network activity and capture
the required information. The block API is useful when you think auto instrumented code misses important activity and prematurely ends a transaction.
An example of this might be a page that contains lots of asynchronous tasks that cannot be automatically instrumented, like web workers.

```js
// get the current active autoinstrumented transaction (page-load, route-change, etc.)
const activeTransaction = apm.getCurrentTransaction()

if (activeTransaction) {
  activeTransaction.block(true)
}

// Perform some more async tasks and unblock it
activeTransaction.block(false)
```

One can also achieve a similar action by creating blocked spans. Check the <DocBadge><DocIcon size="s" type="unlink" title="missing link"/> missing link</DocBadge>{/*  <DocLink id="enApmAgentRumJsCustomTransactions" section="creating-a-managed-transaction">managed transactions</DocLink> */} guide to learn more.

<div id="transaction-add-labels"></div>

### `transaction.addLabels()`

```js
transaction.addLabels({ [name]: value })
```

Add several labels on the transaction. If an error happens during the transaction,
it will also get tagged with the same labels.

Labels are key/value pairs that are indexed by Elasticsearch and therefore searchable (as opposed to data set via <DocLink id="serverlessObservabilityApmAgentsRumApi" section="apmsetcustomcontext">`apm.setCustomContext()`</DocLink>).

<DocCallOut title="Tip">
Before using custom labels, ensure you understand the different types of
[metadata](((apm-guide-ref))/metadata.html) that are available.
</DocCallOut>

Arguments:

* `name` - Any string. All periods (.), asterisks (*), and double quotation marks (") will be replaced by underscores (_), as those characters have special meaning in Elasticsearch

* `value` - Any string, boolean, or number. All other data types will be converted to a string
    before being sent to the APM Server.

<DocCallOut title="Warning" color="warning">
Avoid defining too many user-specified tags.
Defining too many unique fields in an index is a condition that can lead to a
[mapping explosion](((ref))/mapping.html#mapping-limit-settings).
</DocCallOut>

<div id="transaction-end"></div>

### `transaction.end()`

```js
transaction.end()
```

Ends the transaction. Calling `transaction.end` on an active transaction ends all of the underlying spans and marks them as `truncated`.
If the transaction has already ended, nothing happens.

<div id="transaction-mark"></div>

### `transaction.mark(key)`

```js
transaction.mark(key)
```

Marks the current point in time relative to the start of the transaction.
Use this method to mark significant events that happen while the transaction is active.

Arguments:

* `key` -  Any string. All periods (.), asterisks (*), and double quotation marks (") will be replaced by underscores (_), as those characters have special meaning in Elasticsearch

