

{/* import SetupGetAgentWidget from './transclusion/setup/get-agent-widget.mdx' */}

<div id="setup-javaagent"></div>

Using the `-javaagent` option is the most common way to set up java agents on a JVM, it has the following properties:

- No application code changes required.
- Requires to change JVM arguments, which implies a restart of the whole JVM.
- For application servers, the JVM arguments modification requires changing application server configuration
- Agent artifact is an extra binary to manage alongside the JVM or application server.
- Ensures that the application is fully instrumented before it starts.

<div id="setup-javaagent-get-agent"></div>

### Get the Java agent

The first step in getting started with the Elastic APM Java agent is to retrieve a copy of the agent jar.

<div style={{ backgroundColor: "#F1F4FA", width: "100%", height: "250px", textAlign: "center", paddingTop: "110px", marginBottom: "20px" }}><DocIcon type="documents" title="missing snippet"/> missing snippet</div>
{/* <SetupGetAgentWidget  /> */}


<DocCallOut title="Note">
Agents are not like regular application dependencies.
Don't declare a dependency to the agent in your application.
</DocCallOut>

<div id="setup-javaagent-add-flag"></div>

### Add `-javaagent` flag
When starting your application, add the JVM flag `-javaagent:/path/to/elastic-apm-agent-<version>.jar`

<div id="application-server-setup"></div>

## Set up the agent with Application Servers
Different application servers have different ways of setting the `-javaagent` flag and system properties.

Note that system properties are only one way of configuring the agent but setting the `-javaagent` flag is required in each case.
See <DocLink id="serverlessObservabilityApmAgentsJavaConfigure">Configuration</DocLink> to learn about how to configure the agent with a configuration file or environment variables.

<div id="setup-generic"></div>

### Generic Setup
Start your application (for example a Spring Boot application or other embedded servers) and add the `-javaagent` JVM flag.
Use the `-D` prefix to configure the agent using system properties.

```bash
java -javaagent:/path/to/elastic-apm-agent-<version>.jar -Delastic.apm.service_name=my-cool-service -Delastic.apm.application_packages=org.example,org.another.example -Delastic.apm.server_url=http://127.0.0.1:8200 -jar my-application.jar
```

<div id="setup-tomcat"></div>

### Apache Tomcat

<div id="setup-tomcat-unix"></div>

#### Unix
Create `bin/setenv.sh` (or modify if the file already exists).
Make sure to make the file executable, for example `chmod +x bin/setenv.sh`

Add the following line:

<p id="setenvsh"><strong>setenv.sh</strong></p>

```bash
export CATALINA_OPTS="$CATALINA_OPTS -javaagent:/path/to/elastic-apm-agent-<version>.jar"
export CATALINA_OPTS="$CATALINA_OPTS -Delastic.apm.service_name=my-cool-service"
export CATALINA_OPTS="$CATALINA_OPTS -Delastic.apm.application_packages=org.example,org.another.example"
export CATALINA_OPTS="$CATALINA_OPTS -Delastic.apm.server_url=http://127.0.0.1:8200"
```

<div id="setup-tomcat-windows"></div>

#### Windows
Create `bin\setenv.bat` (or modify if the file already exists).

<p id="setenvbat"><strong>setenv.bat</strong></p>

```batch
set CATALINA_OPTS=%CATALINA_OPTS% -javaagent:C:/path/to/elastic-apm-agent-<version>.jar
set CATALINA_OPTS=%CATALINA_OPTS% -Delastic.apm.service_name=my-cool-service
set CATALINA_OPTS=%CATALINA_OPTS% -Delastic.apm.application_packages=org.example,org.another.example
set CATALINA_OPTS=%CATALINA_OPTS% -Delastic.apm.server_url=http://127.0.0.1:8200
```

<div id="setup-jetty"></div>

### Jetty

Option 1: edit `jetty.sh`

<p id="jettysh"><strong>jetty.sh</strong></p>

```bash
export JAVA_OPTIONS="${JAVA_OPTIONS} -javaagent:/path/to/elastic-apm-agent-<version>.jar"
export JAVA_OPTIONS="${JAVA_OPTIONS} -Delastic.apm.service_name=my-cool-service"
export JAVA_OPTIONS="${JAVA_OPTIONS} -Delastic.apm.application_packages=org.example,org.another.example"
export JAVA_OPTIONS="${JAVA_OPTIONS} -Delastic.apm.server_url=http://127.0.0.1:8200"
```

Option 2: edit `start.ini`

<p id="startini"><strong>start.ini</strong></p>

```ini
--exec
-javaagent:/path/to/elastic-apm-agent-<version>.jar
-Delastic.apm.service_name=my-cool-service
-Delastic.apm.application_packages=org.example,org.another.example
-Delastic.apm.server_url=http://127.0.0.1:8200
```

Option 3: If you are using embedded Jetty, see <DocLink id="serverlessObservabilityApmAgentsJavaGetStarted" section="generic-setup">Generic Setup</DocLink>.

<div id="setup-jboss-wildfly"></div>

### JBoss EAP/WildFly

<div id="setup-jboss-wildfly-standalone"></div>

#### Standalone Mode
Add the agent configuration at the bottom of the `standalone.conf` file:

**Unix**

<p id="binstandaloneconf"><strong>bin/standalone.conf</strong></p>

```bash
export JAVA_OPTS="$JAVA_OPTS -javaagent:/path/to/elastic-apm-agent-<version>.jar"
export JAVA_OPTS="$JAVA_OPTS -Delastic.apm.service_name=my-cool-service"
export JAVA_OPTS="$JAVA_OPTS -Delastic.apm.application_packages=org.example,org.another.example"
export JAVA_OPTS="$JAVA_OPTS -Delastic.apm.server_url=http://127.0.0.1:8200"
```

**Windows**

<p id="binstandaloneconfbat"><strong>bin/standalone.conf.bat</strong></p>

```bash
set JAVA_OPTS=%JAVA_OPTS% -javaagent:C:/path/to/elastic-apm-agent-<version>.jar
set JAVA_OPTS=%JAVA_OPTS% -Delastic.apm.service_name=my-cool-service
set JAVA_OPTS=%JAVA_OPTS% -Delastic.apm.application_packages=org.example,org.another.example
set JAVA_OPTS=%JAVA_OPTS% -Delastic.apm.server_url=http://127.0.0.1:8200
```

<div id="setup-jboss-wildfly-domain"></div>

#### Domain Mode
Edit the `domain.xml` file which is usually located under `domain/configuration` and add a JVM option for the `-javaagent` flag,
as well as some system properties for the configuration.

<p id="domainconfigurationdomainxml"><strong>domain/configuration/domain.xml</strong></p>

```xml
...
<server-group>
  <jvm>
     <jvm-options>
      ...
      <option value="-javaagent:/path/to/elastic-apm-agent-<version>.jar"/>
      ...
     </jvm-options>
  </jvm>
</server-group>
...
<system-properties>
  <property name="elastic.apm.service_name"         value="my-cool-service"/>
  <property name="elastic.apm.application_packages" value="org.example,org.another.example"/>
  <property name="elastic.apm.server_url"          value="http://127.0.0.1:8200"/>
</system-properties>
...
```

<div id="setup-websphere-liberty"></div>

### WebSphere Liberty
Add the following lines to the `jvm.options` file.

<p id="jvmoptions"><strong>jvm.options</strong></p>

```options
-javaagent:/path/to/elastic-apm-agent-<version>.jar
-Delastic.apm.service_name=my-cool-service
-Delastic.apm.application_packages=org.example,org.another.example
-Delastic.apm.server_url=http://127.0.0.1:8200
```

<div id="setup-payara"></div>

### Payara
Update the `domain.xml` file to add the `-javaagent` flag and system properties.

<p id="glassfishdomainsdomain1configdomainxml"><strong>glassfish/domains/domain1/config/domain.xml</strong></p>

```xml
<java-config>
  ...
  <jvm-options>-javaagent:/path/to/elastic-apm-agent-<version>.jar</jvm-options>
  <jvm-options>-Delastic.apm.service_name=my-cool-service</jvm-options>
  <jvm-options>-Delastic.apm.application_packages=org.example,org.another.example</jvm-options>
  <jvm-options>-Delastic.apm.server_url=http://127.0.0.1:8200</jvm-options>
</java-config>
```

<div id="setup-weblogic"></div>

### Oracle WebLogic

<div id="setup-weblogic-unix"></div>

#### Unix
Edit the `startWebLogic.sh` file and add the following lines after the `setDomainEnv.sh` call:

<p id="dollardomain_homebinstartweblogicsh"><strong>$DOMAIN_HOME/bin/startWebLogic.sh</strong></p>

```bash
export JAVA_OPTIONS="$JAVA_OPTIONS -javaagent:/path/to/elastic-apm-agent-<version>.jar"
export JAVA_OPTIONS="$JAVA_OPTIONS -Delastic.apm.service_name=my-cool-service"
export JAVA_OPTIONS="$JAVA_OPTIONS -Delastic.apm.application_packages=org.example,org.another.example"
export JAVA_OPTIONS="$JAVA_OPTIONS -Delastic.apm.server_url=http://127.0.0.1:8200"
```

<div id="setup-weblogic-windows"></div>

#### Windows
Edit the `startWebLogic.cmd` file and add the following lines after the `setDomainEnv.cmd` call:

<p id="percentdomain_homepercent\bin\startweblogiccmd"><strong>%DOMAIN_HOME%\bin\startWebLogic.cmd</strong></p>

```batch
set JAVA_OPTIONS=%JAVA_OPTIONS% -javaagent:C:/path/to/elastic-apm-agent-<version>.jar
set JAVA_OPTIONS=%JAVA_OPTIONS% -Delastic.apm.service_name=my-cool-service
set JAVA_OPTIONS=%JAVA_OPTIONS% -Delastic.apm.application_packages=org.example,org.another.example
set JAVA_OPTIONS=%JAVA_OPTIONS% -Delastic.apm.server_url=http://127.0.0.1:8200
```

<div id="setup-cloud-foundry"></div>

### Cloud Foundry
The Elastic Java APM Agent Framework is now part of the Cloud Foundry Java Buildpack as of [Release v4.19](https://github.com/cloudfoundry/java-buildpack/releases/tag/v4.19).

A user provided Elastic APM service must have a name or tag with `elastic-apm` in it so that the Elastic APM Agent Framework will automatically configure the application to work with the service.

Create a user provided service:

`cf cups my-elastic-apm-service -p '{"server_url":"my-apm-server-url","secret_token":"my-apm-server-secret-token"}'`

Both `my-apm-server-url` and `my-apm-server-secret-token` are respectively `server_url` and `secret_token` from service-key of your Elasticsearch server.

Bind the application to the service:

`cf bind-service my-application my-elastic-apm-service`

and restage the application or use the `services` block in the application manifest file.

For more details on the Elastic Java APM Agent Framework for Cloud Foundry see [here](https://github.com/cloudfoundry/java-buildpack/blob/main/docs/framework-elastic_apm_agent.md).

<p id="manifestyml"><strong>manifest.yml</strong></p>

```yml
applications:
- name: my-application
  memory: 1G
  path: ./target/my-application.jar
  services:
    - my-elastic-apm-service
```
