{/* Comes from sandbox.elastic.dev/test-books/apm/guide/transclusion/tab-widgets/install-agents/ruby.mdx */}

**Install the ((apm-agent))**

Add the agent to your Gemfile.

```ruby
gem 'elastic-apm'
```

**Configure the agent**

<DocTabs>
  <DocTab name="Ruby on Rails">
    APM is automatically started when your app boots.
    Configure the agent by creating the config file `config/elastic_apm.yml`:

    ```ruby
    # config/elastic_apm.yml:
    service_name: '<your-service-name>' [^1]
    api_key: '<your-api-key>' [^2]
    server_url: '<your-server-url>' [^3]
    environment: '<your-environment>' [^4]
    ```
    [^1]: The service name is the primary filter in the Applications UI and is used to group errors and trace data together. Allowed characters are a-z, A-Z, 0-9, -, _, and space. Defaults to the name of your Rails app.
    [^2]: Used to ensure that only your agents can send data to your project.
    [^3]: Set the custom APM Server URL (default: http://localhost:8200). The URL must be fully qualified, including protocol (http or https) and port.
    [^4]: The name of the environment this service is deployed in, for example, "production" or "staging". Environments allow you to easily filter data on a global level in the Applications UI. It's important to be consistent when naming environments across agents.

  </DocTab>
  <DocTab name="Rack">
    For Rack or a compatible framework, like Sinatra, include the middleware in your app and start the agent.

    ```ruby
    # config.ru
    require 'sinatra/base'
    class MySinatraApp < Sinatra::Base
      use ElasticAPM::Middleware
      # ...
    end
    ElasticAPM.start(
      app: MySinatraApp, # required
      config_file: '' # optional, defaults to config/elastic_apm.yml
    )
    run MySinatraApp
    at_exit { ElasticAPM.stop }
    ```

    Create a config file `config/elastic_apm.yml`:

    ```ruby
    # config/elastic_apm.yml:
    service_name: '<your-service-name>' [^1]
    api_key: '<your-api-key>' [^2]
    server_url: '<your-server-url>' [^3]
    environment: '<your-environment>' [^4]
    ```
    [^1]: The service name is the primary filter in the Applications UI and is used to group errors and trace data together. Allowed characters are a-z, A-Z, 0-9, -, _, and space. Defaults to the name of your Rack app's class.
    [^2]: Used to ensure that only your agents can send data to your project.
    [^3]: Set the custom APM Server URL (default: http://localhost:8200). The URL must be fully qualified, including protocol (http or https) and port.
    [^4]: The name of the environment this service is deployed in, for example, "production" or "staging". Environments allow you to easily filter data on a global level in the Applications UI. It's important to be consistent when naming environments across agents.

  </DocTab>
</DocTabs>
