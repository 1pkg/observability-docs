{/* Comes from sandbox.elastic.dev/test-books/apm/guide/transclusion/tab-widgets/install-agents/net.mdx */}

**Download the ((apm-agent))**

Add the agent packages from [NuGet](https://www.nuget.org/packages?q=Elastic.apm) to your .NET application.
There are multiple NuGet packages available for different use cases.

For an ASP.NET Core application with Entity Framework Core, download the
[Elastic.Apm.NetCoreAll](https://www.nuget.org/packages/Elastic.Apm.NetCoreAll) package.
This package will automatically add every agent component to your application.

To minimize the number of dependencies, you can use the
[Elastic.Apm.AspNetCore](https://www.nuget.org/packages/Elastic.Apm.AspNetCore) package for just ASP.NET Core monitoring, or the
[Elastic.Apm.EfCore](https://www.nuget.org/packages/Elastic.Apm.EntityFrameworkCore) package for just Entity Framework Core monitoring.

If you only want to use the public agent API for manual instrumentation, use the
[Elastic.Apm](https://www.nuget.org/packages/Elastic.Apm) package.

**Add the agent to the application**

For an ASP.NET Core application with the `Elastic.Apm.NetCoreAll` package,
call the `UseAllElasticApm` method in the `Configure` method within the `Startup.cs` file:

```dotnet
public class Startup
{
  public void Configure(IApplicationBuilder app, IHostingEnvironment env)
  {
    app.UseAllElasticApm(Configuration);
    //…rest of the method
  }
  //…rest of the class
}
```

You can optionally pass an `IConfiguration` instance, and the agent will read
config settings through the `IConfiguration` instance, for example,
from the `appsettings.json` file:

```json
{
  "ElasticApm": {
    "ServiceName": "<your-service-name>", [^1]
    "ApiKey": "<your-api-key>", [^2]
    "ServerUrl": "<your-server-url>", [^3]
    "Environment": "<your-environment>", [^4]
  }
}
```
[^1]: The service name is the primary filter in the APM UI and is used to group errors and trace data together. Allowed characters are a-z, A-Z, 0-9, -, _, and space. Default is the entry assembly of the application.
[^2]: Used to ensure that only your agents can send data to your project.
[^3]: Set the custom APM Server URL (default: http://localhost:8200). The URL must be fully qualified, including protocol (http or https) and port.
[^4]: The name of the environment this service is deployed in, for example, "production" or "staging". Environments allow you to easily filter data on a global level in the APM UI. It's important to be consistent when naming environments across agents.

If you don't pass an `IConfiguration` instance to the agent, for example, in a non-ASP.NET Core application,
you can configure the agent with environment variables.
See the agent reference for more information.
